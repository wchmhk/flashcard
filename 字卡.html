// Show current card to review
function showCurrentCard() {
    // 重置卡片狀態
    cardFront.classList.remove('hidden');
    cardBack.classList.add('hidden');
    ratingButtons.classList.add('hidden');

    // 设置卡片布局样式
    cardFront.className = "flex flex-col w-full h-full justify-between"; 
    cardBack.className = "flex flex-col w-full h-full justify-between hidden";

    // 确保文字区域有最小高度
    frontText.style.minHeight = "80px";
    backText.style.minHeight = "80px";

    // 清空類別但保留DOM結構
    frontText.className = "";
    backText.className = "";
    
    // 添加邊距類別，但不覆蓋其他類別
    frontText.classList.add("mb-6", "px-2");
    backText.classList.add("mb-6", "px-2");

    // 獲取當前卡片
    const card = cardsToReview[currentCardIndex];
    if (!card) return;

    // 根據sidesFlipped決定顯示方式
    if (sidesFlipped) {
        // 正反面互換
        frontText.innerHTML = card.backText || '';
        backText.innerHTML = card.frontText || '';

        // 處理圖片顯示
        frontImage.innerHTML = '';
        backImage.innerHTML = '';

        if (card.backImage) {
            const imgContainer = createZoomableImage(card.backImage);
            frontImage.appendChild(imgContainer);
        }

        if (card.frontImage) {
            const imgContainer = createZoomableImage(card.frontImage);
            backImage.appendChild(imgContainer);
        }
    } else {
        // 正常顯示
        frontText.innerHTML = card.frontText || '';
        backText.innerHTML = card.backText || '';

        // 處理圖片顯示
        frontImage.innerHTML = '';
        backImage.innerHTML = '';

        if (card.frontImage) {
            const imgContainer = createZoomableImage(card.frontImage);
            frontImage.appendChild(imgContainer);
        }

        if (card.backImage) {
            const imgContainer = createZoomableImage(card.backImage);
            backImage.appendChild(imgContainer);
        }
    }
    
    // 確保文本格式被正確應用
    // 處理對齊方式
    const alignCenterElements = frontText.querySelectorAll('.ql-align-center');
    alignCenterElements.forEach(el => {
        el.style.textAlign = 'center';
    });
    const backAlignCenterElements = backText.querySelectorAll('.ql-align-center');
    backAlignCenterElements.forEach(el => {
        el.style.textAlign = 'center';
    });

    // 處理斜體
    const italicElements = frontText.querySelectorAll('em, .ql-italic');
    italicElements.forEach(el => {
        el.style.fontStyle = 'italic';
    });
    const backItalicElements = backText.querySelectorAll('em, .ql-italic');
    backItalicElements.forEach(el => {
        el.style.fontStyle = 'italic';
    });
}
